<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monkey Warehouse</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --bg: #0a0a0a; --card: #121212; --accent: #ffd32a; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; }
        
        header { 
            height: 45vh; display: flex; justify-content: center; align-items: center;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('header.jpg'); 
            background-size: cover; background-position: center; border-bottom: 3px solid var(--accent);
        }
        header img { max-width: 220px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 40px; padding: 60px 20px; max-width: 1400px; margin: 0 auto; }
        
        .product-card { background: var(--card); border-radius: 24px; overflow: hidden; border: 1px solid #1f1f1f; transition: 0.3s; }
        .product-card:hover { border-color: var(--accent); }

        .slider { width: 100%; aspect-ratio: 1 / 1; overflow: hidden; position: relative; background: #1a1a1a; }
        .slider img { width: 100%; height: 100%; object-fit: cover; display: none; position: absolute; }
        .slider img.active { display: block; animation: fade 0.6s; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

        .info { padding: 30px; }
        h2 { margin: 0; color: var(--accent); font-size: 1.5rem; text-transform: uppercase; }
        .price { font-size: 2.2rem; font-weight: 800; margin: 10px 0; }
        .desc { color: #888; font-size: 0.9rem; margin-bottom: 20px; min-height: 50px; }

        .options { display: flex; gap: 10px; margin-bottom: 20px; }
        select { 
            flex: 1; background: #1a1a1a; color: white; border: 1px solid #333; 
            padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold;
        }
        select:focus { border-color: var(--accent); }

        .btn { 
            display: block; text-align: center; padding: 18px; background: var(--accent); 
            color: black; text-decoration: none; border-radius: 14px; font-weight: 900;
            text-transform: uppercase; transition: 0.3s;
        }
        .btn:hover { background: white; transform: scale(1.02); }
    </style>
</head>
<body>

    <header><img src="logo_white.png" alt="Logo"></header>
    <div id="shop-grid" class="grid"></div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTEhTrbEm6y5Bl67WK0wDCbkQLoUUx-VV9n-0KFhhsY6tJjpPKm_iMuxnS2H3neRU7RxbRw8RDoMTSE/pub?output=csv';
        const GITHUB_USER = 'angecomputer-cpu';
        const GITHUB_REPO = 'monkeywearhouseshop';
        const PAYPAL_BASE = 'https://www.paypal.com/paypalme/JhonBanas';

        async function load() {
            Papa.parse(CSV_URL, {
                download: true, header: true,
                complete: async (res) => {
                    const grid = document.getElementById('shop-grid');
                    for (let p of res.data) {
                        if (!p.id) continue;
                        const gh = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/img/${p.cartella_foto}`);
                        const files = await gh.json();
                        let imgs = '';
                        files.forEach((f, i) => {
                            if (f.name.match(/\.(jpg|jpeg|png|webp)$/i)) {
                                imgs += `<img src="${f.download_url}" class="${i === 0 ? 'active' : ''}">`;
                            }
                        });

                        grid.innerHTML += `
                            <div class="product-card">
                                <div class="slider" id="s-${p.id}">${imgs}</div>
                                <div class="info">
                                    <h2>${p.nome}</h2>
                                    <div class="price">${p.prezzo}â‚¬</div>
                                    <p class="desc">${p.descrizione}</p>
                                    <div class="options">
                                        <select id="size-${p.id}" onchange="updateLink('${p.id}', '${p.prezzo}', '${p.nome}')">
                                            <option value="S">S</option>
                                            <option value="M" selected>M</option>
                                            <option value="L">L</option>
                                            <option value="XL">XL</option>
                                        </select>
                                        <select id="color-${p.id}" onchange="updateLink('${p.id}', '${p.prezzo}', '${p.nome}')">
                                            <option value="Black">BLACK</option>
                                            <option value="White">WHITE</option>
                                        </select>
                                    </div>
                                    <a href="" id="btn-${p.id}" class="btn" target="_blank">ACQUISTA ORA</a>
                                </div>
                            </div>`;
                        startSlider(`s-${p.id}`);
                        updateLink(p.id, p.prezzo, p.nome);
                    }
                }
            });
        }

        function updateLink(id, prezzo, prodName) {
            const size = document.getElementById(`size-${id}`).value;
            const color = document.getElementById(`color-${id}`).value;
            const btn = document.getElementById(`btn-${id}`);
            
            // Costruisce l'URL: BASE / PREZZO + Valuta ? Messaggio
            const message = encodeURIComponent(`${prodName} (${size} - ${color})`);
            btn.href = `${PAYPAL_BASE}/${prezzo}EUR?item_name=${message}`;
        }

        function startSlider(id) {
            let curr = 0;
            const imgs = document.getElementById(id).querySelectorAll('img');
            if (imgs.length < 2) return;
            setInterval(() => {
                imgs[curr].classList.remove('active');
                curr = (curr + 1) % imgs.length;
                imgs[curr].classList.add('active');
            }, 3000);
        }
        load();
    </script>
</body>
</html>
