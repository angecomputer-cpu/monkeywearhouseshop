<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monkey Warehouse - Official Shop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --main-bg: #0a0a0a; --card-bg: #151515; --accent: #ff4500; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--main-bg); color: white; margin: 0; text-align: center; }
        header { padding: 40px; background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('header.jpg'); background-size: cover; border-bottom: 2px solid var(--accent); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; padding: 40px; max-width: 1200px; margin: 0 auto; }
        .product-card { background: var(--card-bg); padding: 20px; border-radius: 15px; border: 1px solid #333; transition: transform 0.3s; }
        .product-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .slider { width: 100%; height: 350px; overflow: hidden; position: relative; border-radius: 10px; background: #000; }
        .slider img { width: 100%; height: 100%; object-fit: contain; display: none; position: absolute; top: 0; left: 0; }
        .slider img.active { display: block; }
        h2 { margin: 15px 0 10px; font-size: 1.4rem; }
        .price { font-size: 1.8rem; color: #00ff88; font-weight: bold; margin: 10px 0; }
        .desc { font-size: 0.9rem; color: #bbb; height: 40px; overflow: hidden; }
        .btn { display: inline-block; padding: 12px 25px; background: var(--accent); color: white; text-decoration: none; border-radius: 30px; font-weight: bold; margin-top: 15px; transition: 0.3s; }
        .btn:hover { background: white; color: var(--accent); }
    </style>
</head>
<body>

    <header>
        <img src="logo_w.png" alt="Monkey Warehouse" style="max-width: 200px;">
        <h1>MONKEY WAREHOUSE</h1>
        <p>Exclusive Streetwear for the Committed</p>
    </header>

    <div id="shop-grid" class="grid">Caricamento prodotti in corso...</div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTEhTrbEm6y5Bl67WK0wDCbkQLoUUx-VV9n-0KFhhsY6tJjpPKm_iMuxnS2H3neRU7RxbRw8RDoMTSE/pub?output=csv';
        const GITHUB_USER = 'angecomputer-cpu';
        const GITHUB_REPO = 'monkeywearhouseshop';

        async function initShop() {
            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                complete: async (results) => {
                    const products = results.data;
                    const container = document.getElementById('shop-grid');
                    container.innerHTML = '';

                    for (let p of products) {
                        if (!p.id || !p.cartella_foto) continue;
                        
                        try {
                            // Chiamata API a GitHub per scansionare la cartella immagini
                            const res = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/img/${p.cartella_foto}`);
                            const files = await res.json();
                            
                            let imgsHtml = '';
                            let first = true;
                            
                            files.forEach(file => {
                                if (file.name.match(/\.(jpg|jpeg|png|webp)$/i)) {
                                    imgsHtml += `<img src="${file.download_url}" class="${first ? 'active' : ''}">`;
                                    first = false;
                                }
                            });

                            container.innerHTML += `
                                <div class="product-card">
                                    <div class="slider" id="slider-${p.id}">${imgsHtml}</div>
                                    <h2>${p.nome}</h2>
                                    <p class="desc">${p.descrizione}</p>
                                    <div class="price">${p.prezzo}â‚¬</div>
                                    <a href="${p.link_paypal}" target="_blank" class="btn">ACQUISTA ORA</a>
                                </div>
                            `;
                            
                            animateSlider(`slider-${p.id}`);
                        } catch (e) { console.error("Errore caricamento cartella:", p.cartella_foto); }
                    }
                }
            });
        }

        function animateSlider(id) {
            const container = document.getElementById(id);
            const imgs = container.querySelectorAll('img');
            if (imgs.length <= 1) return;
            
            let current = 0;
            setInterval(() => {
                imgs[current].classList.remove('active');
                current = (current + 1) % imgs.length;
                imgs[current].classList.add('active');
            }, 3000);
        }

        initShop();
    </script>
</body>
</html>
